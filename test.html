<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo Bloom - ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .success { color: green; }
        .error { color: red; }
        input[type="text"] { padding: 5px; margin: 5px; width: 200px; }
        select { padding: 5px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ğŸŒ¸ Echo Bloom - JavaScript ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h2>1. ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testBasicFunctions()">ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</button>
        <div id="basicTest" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>2. í™•ì–¸ ìƒì„± í…ŒìŠ¤íŠ¸</h2>
        <label>ë¬¸ì œ ì„ íƒ:</label><br>
        <input type="checkbox" name="problems" value="1"> ìì‹ ê° ë¶€ì¡±
        <input type="checkbox" name="problems" value="2"> ë¶ˆì•ˆê°
        <input type="checkbox" name="problems" value="3"> ìš°ìš¸ê°<br>
        
        <label>í†¤ ì„ íƒ:</label>
        <select id="toneSelect">
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="1">ë”°ëœ»í•˜ê³  ë¶€ë“œëŸ¬ìš´</option>
            <option value="2">í˜ì°¨ê³  ê°•í•œ</option>
            <option value="3">ì°¨ë¶„í•˜ê³  ì•ˆì •ì ì¸</option>
        </select><br>
        
        <button onclick="testAffirmationGeneration()">í™•ì–¸ ìƒì„± í…ŒìŠ¤íŠ¸</button>
        <div id="affirmationTest" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>3. ìŒì„± ì¸ì‹ í…ŒìŠ¤íŠ¸</h2>
        <input type="text" id="testSentence" placeholder="í…ŒìŠ¤íŠ¸í•  ë¬¸ì¥" value="ë‚˜ëŠ” í•  ìˆ˜ ìˆì–´">
        <button onclick="testSpeechRecognition()">ìŒì„± ì¸ì‹ í…ŒìŠ¤íŠ¸</button>
        <div id="speechTest" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>4. ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸</h2>
        <input type="text" id="bookmarkText" placeholder="ë¶ë§ˆí¬í•  ë¬¸ì¥" value="ë‚˜ëŠ” ì†Œì¤‘í•œ ì‚¬ëŒì´ì•¼">
        <button onclick="testBookmark()">ë¶ë§ˆí¬ ì¶”ê°€</button>
        <button onclick="testGetBookmarks()">ë¶ë§ˆí¬ ì¡°íšŒ</button>
        <div id="bookmarkTest" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>5. ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸</h2>
        <button onclick="runAllTests()">ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div id="allTests" class="test-result"></div>
    </div>

    <!-- JavaScript ë°±ì—”ë“œ ë¡œë“œ -->
    <script src="js-backend.js"></script>
    <script src="speech-recognition.js"></script>
    <script src="mock-server.js"></script>
    <script src="app-enhanced.js"></script>

    <script>
        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        async function testBasicFunctions() {
            const result = document.getElementById('basicTest');
            result.innerHTML = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                // ë°±ì—”ë“œ ì¸ìŠ¤í„´ìŠ¤ í™•ì¸
                if (!window.echoBloomBackend) {
                    throw new Error('ë°±ì—”ë“œ ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤');
                }
                
                // ì‚¬ìš©ì ì¸ì¦ í…ŒìŠ¤íŠ¸
                const authResult = await window.echoBloomBackend.authenticateUser();
                
                // ì¹´í…Œê³ ë¦¬ ë°ì´í„° í™•ì¸
                const problems = window.echoBloomBackend.getCategories('PROBLEM');
                const tones = window.echoBloomBackend.getCategories('TONE');
                
                result.innerHTML = `
                    <div class="success">âœ… ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì„±ê³µ!</div>
                    <p>ì‚¬ìš©ì ì¸ì¦: ${authResult.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}</p>
                    <p>ë¬¸ì œ ì¹´í…Œê³ ë¦¬: ${problems.length}ê°œ</p>
                    <p>í†¤ ì¹´í…Œê³ ë¦¬: ${tones.length}ê°œ</p>
                    <p>í˜„ì¬ ì‚¬ìš©ì: ${authResult.user.name}</p>
                `;
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        async function testAffirmationGeneration() {
            const result = document.getElementById('affirmationTest');
            result.innerHTML = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                const checkedProblems = Array.from(document.querySelectorAll('input[name="problems"]:checked'))
                    .map(cb => parseInt(cb.value));
                const selectedTone = parseInt(document.getElementById('toneSelect').value) || null;
                
                if (checkedProblems.length === 0) {
                    checkedProblems.push(1); // ê¸°ë³¸ê°’
                }
                
                const affirmations = await window.echoBloomBackend.generateAffirmations(checkedProblems, selectedTone);
                
                result.innerHTML = `
                    <div class="success">âœ… í™•ì–¸ ìƒì„± ì„±ê³µ!</div>
                    <p><strong>í™•ì–¸ 1:</strong> ${affirmations.affirmation1}</p>
                    <p><strong>í™•ì–¸ 2:</strong> ${affirmations.affirmation2}</p>
                    <p><strong>í™•ì–¸ 3:</strong> ${affirmations.affirmation3}</p>
                `;
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        async function testSpeechRecognition() {
            const result = document.getElementById('speechTest');
            const sentence = document.getElementById('testSentence').value;
            
            if (!sentence) {
                result.innerHTML = '<div class="error">âŒ í…ŒìŠ¤íŠ¸í•  ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”</div>';
                return;
            }
            
            result.innerHTML = 'ìŒì„± ì¸ì‹ í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                // Mock ìŒì„± ì¸ì‹ ê²°ê³¼ ìƒì„±
                const speechResult = window.echoBloomBackend.generateMockSpeechResult(sentence);
                
                result.innerHTML = `
                    <div class="success">âœ… ìŒì„± ì¸ì‹ í…ŒìŠ¤íŠ¸ ì„±ê³µ!</div>
                    <p><strong>ì›ë³¸:</strong> ${speechResult.originalSentence}</p>
                    <p><strong>ì¸ì‹ ê²°ê³¼:</strong> ${speechResult.recognizedText}</p>
                    <p><strong>ìœ ì‚¬ë„:</strong> ${(speechResult.similarity * 100).toFixed(1)}%</p>
                    <p><strong>ì ìˆ˜:</strong> ${speechResult.score}ì </p>
                    <p><strong>í”¼ë“œë°±:</strong> ${speechResult.feedback}</p>
                    ${speechResult.note ? `<p><em>${speechResult.note}</em></p>` : ''}
                `;
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        async function testBookmark() {
            const result = document.getElementById('bookmarkTest');
            const text = document.getElementById('bookmarkText').value;
            
            if (!text) {
                result.innerHTML = '<div class="error">âŒ ë¶ë§ˆí¬í•  ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”</div>';
                return;
            }
            
            try {
                const bookmark = await window.echoBloomBackend.addBookmark(text);
                result.innerHTML = `<div class="success">âœ… ë¶ë§ˆí¬ ì¶”ê°€ ì„±ê³µ! ID: ${bookmark.id}</div>`;
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        async function testGetBookmarks() {
            const result = document.getElementById('bookmarkTest');
            
            try {
                const bookmarks = await window.echoBloomBackend.getBookmarks();
                result.innerHTML = `
                    <div class="success">âœ… ë¶ë§ˆí¬ ì¡°íšŒ ì„±ê³µ!</div>
                    <p>ì´ ${bookmarks.length}ê°œì˜ ë¶ë§ˆí¬</p>
                    ${bookmarks.map(b => `<p>â€¢ ${b.sentence}</p>`).join('')}
                `;
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        async function runAllTests() {
            const result = document.getElementById('allTests');
            result.innerHTML = 'ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';
            
            let passed = 0;
            let total = 4;
            
            try {
                // 1. ê¸°ë³¸ ê¸°ëŠ¥
                await window.echoBloomBackend.authenticateUser();
                passed++;
                
                // 2. í™•ì–¸ ìƒì„±
                await window.echoBloomBackend.generateAffirmations([1], 1);
                passed++;
                
                // 3. ìŒì„± ì¸ì‹
                window.echoBloomBackend.generateMockSpeechResult('í…ŒìŠ¤íŠ¸');
                passed++;
                
                // 4. ë°ì´í„° ì €ì¥
                await window.echoBloomBackend.addBookmark('í…ŒìŠ¤íŠ¸ ë¶ë§ˆí¬');
                passed++;
                
                result.innerHTML = `
                    <div class="success">âœ… ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!</div>
                    <p>í†µê³¼: ${passed}/${total}</p>
                    <p>ì„±ê³µë¥ : ${Math.round((passed/total)*100)}%</p>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="error">âŒ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</div>
                    <p>í†µê³¼: ${passed}/${total}</p>
                    <p>ì˜¤ë¥˜: ${error.message}</p>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.addEventListener('load', () => {
            setTimeout(() => {
                testBasicFunctions();
            }, 1000);
        });
    </script>
</body>
</html>
